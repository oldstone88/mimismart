/*
<?xml version="1.0" encoding="UTF-8"?>
<xml>
	<langs>
		<tplvar name="DESCRIPTION_1" en="Script to the remote ARC466A33" ru="Скрипт для пульта ARC466A33" />
		<tplvar name="ITEM1" ru="ИК-передатчик" en="IR transmitter" />
		<tplvar name="ITEM2" ru="Имя кондиционера" en="Air conditioning name" />

	</langs>
	<description>
		<b>##DESCRIPTION_1##</b>
	</description>
				
	<name value="ARC466A33"/>
	<tag value="import-script"/>
	<target value="IRT"/>
	<selectArea value="1"/>

	<additems>
		<additem tag="item" id="%TARGET%" name="NAME" sub-id="%SUBID%" type="conditioner" vane-hor="0xc0" vane-ver="0xc0" t-delta="22" t-min="10"   />
	</additems>


	<item type="devices-list" name="IRT" filter="ir-transmitter" required="1" comment="##ITEM1##"/>
	<item type="string" name="NAME" min="3" max="40" required="1" comment="##ITEM2##" value="ARC466A33"/>
	<item type="hidden" name="COND" value="%TARGET%:%SUBID%"/>

</xml>
*/

// u8 IRCommand[] = {0x19640B000200C50601011000000305108B0D000002B70001028000001039510340108B0D11DA2700C52000F7000350000102800000103A510340108B0D11DA270042E31C530003500001028000001039510398108B0D11DA2700004928005F0F0006600000C1800098}; 


// //Номера байтов для значений(в одном байте может быть 2 параметра)
// u8 OnModeByte   = 91;
// u8 TempByte     = 92;
// u8 FanVertByte  = 94;
// u8 HorByte      = 95;
// u8 CRCByte      = 104;

// //Набор значений для параметров работы кондиционера
// u8 OnOff[]            = {0x08, 0x09};
// u8 Modes[]            = {0x06, 0x03, 0x02, 0x04,0x08};
// u8 Fans[]             = {0x0A,0x03,0x05,0x07};
// u8 VertivalVanes[]    = {0x00, 0x0F};
// u8 HorizontalVanes[]  = {0x00, 0x0F};



u8 b[] = {0x19640B000200C50601011000000305108B0D000002B70001028000001039510340108B0D11DA2700C52000F7000350000102800000103A510340108B0D11DA270042E31C530003500001028000001039510398108B0D11DA2700004928005F0F0006600000C1800098}; 

u8 isOn	= 0;
u8 c 	= 0;
u8 fan[]	= {0xa0, 0x30, 0x50, 0x70};
u8 mode[]	= {0x60, 0x30, 0x20, 0x40, 0x00};
u8 sving[]	= {0x00, 0x02, 0x03, 0x04, 0x05, 0x06, 0x01, 0x00};


// void send()
// {
// 	setStatus(IRT, &IRCommand);
// }
	
V-ID/COND
{
	u8 nf	= (opt(0) & 0x0f);
	u8 m 	= (opt(0) >> 4);
	u8 t 	= (opt(1) & 0x0f);
	u8 f 	= (opt(4) & 0x03);	
	u8 sg 	= (opt(3) & 0x0f);
	u8 sv 	= (opt(3)>>4);


 srvError("on/off = %d m = %d t =%d f = %d sg = %d sv =%d",nf,m,t,f,sg,sv);

	// if(nf==1){
		b[92]=(t+10)*2;
		b[91]=mode[m]|(nf+8);		
		b[94]=fan[f]|sg?0x00:0x0f;
		b[95]=sv?0x00:0x0f;
		for(u8 i=86;i<=103;++i)
			c += b[i];
		b[104]=c;
		setStatus(IRT, &b);

	// }else if(nf==0){
	// 	setStatus(IRT, {0x1964050002008C060103FF000058986719DC6A03231999120009205002000274420101190000032019A71200400070});
	// }




	// u8 text[150]="";
	// for(u8 i1=0; i1<47;++i1){
	// 	sprintf(text+strlen(text), "%.2X", b[i1]);
	// }

	// srvError("                                                fm  o                                  s    r    opt==%d",opt(0)>>4);
	// srvError("%s",&text);





	// cancelDelayedCall(send);
	
	// //Получение комманд из приложения
	// u8 isOn	        = (opt(0) & 0x01);
	// u8 virtMode     = (opt(0) >> 4);
	// u8 virtTemp 	= (opt(1) & 0x0F);
	// u8 virtFan      = (opt(4) & 0x0F);	
	// u8 virtVertVane = (opt(3) >> 4);
	// u8 virtHorVane  = (opt(3) & 0x0F);

	// //Установка соответвующих значений
	// u8 on       = OnOff[isOn];
	// u8 mode     = Modes[virtMode];
	// u8 vertVane = VertivalVanes[virtVertVane];
	// u8 horVane  = HorizontalVanes[virtHorVane];
	// u8 fan      = Fans[virtFan];

	// u8 temp = 2 * virtTemp + 0x24;   
	// if(mode == 0x02)
	// {
	// 	temp = 0x0C;
	// 	if(fan != AUTOFAN)
	// 	{
	// 		setStatus(COND,{[COND.0],[COND.1],[COND.2],[COND.3],([COND.4] & 0xF0)});
	// 		return;
	// 	}
	// }
	// else if(mode == FANMODE && temp != 0x32)
	// {
	// 	setStatus(COND,{[COND.0],(0x32 - 0x24) / 2,[COND.2],[COND.3],[COND.4]});
	// 	return;
	// }

	// u8 crc = (horVane + vertVane + (fan << 4) + (mode << 4) + on + temp) - 0x47;



	// //вставляем параметры в нужное место
	// IRCommand[OnModeByte]    = (mode << 4) | (on & 0x0F);
	// IRCommand[TempByte]      = (temp+10)*2;
	// IRCommand[FanVertByte]   = (fan << 4) | (vertVane & 0xF);
	// IRCommand[HorByte]       = (horVane & 0xF);
	// IRCommand[CRCByte]       = crc;

	// delayedCallMs(send, 550);
}



// |001020304050607 0809 101112 1314151617 18 19202122 2324 252627 282930 3132333435 3637383940414243 44454647 4849 505152 535455 5657585960 6162636465666768 69707172 7374 757677 787980 8182838485 86878889909192939495969798990001020304
//                                                                                                                                                                                                              o                        rr    
// 19640B000200C506 0101 100000 0305108A0D 00 0002AB00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00033F00 0102 800000 103851 0340108B0D 11DA270042EE1B5D 00033F00 0102 800000 103951 0398108B0D 11DA27000048280030000006600000C1800059
// 19640B000200C506 0101 100000 0305108A0D 00 0002AA00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00033F00 0102 800000 103951 0340108B0D 11DA270042EE1B5D 00033F00 0102 800000 103751 0398108B0D 11DA27000049280030000006600000C180005A
//                                                                                                                                                                                                              ott                      rr         
// 19640B000200C506 0101 100000 0305108A0D 00 0002AC00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034100 0102 800000 103851 0340108B0D 11DA270042F51B64 00034100 0102 800000 103951 0398108B0D 11DA27000049280030000006600000C180005A
// 19640B000200C506 0101 100000 0305108A0D 00 0002AC00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034100 0102 800000 103851 0340108B0D 11DA270042F51B64 00034100 0102 800000 103851 0398108B0D 11DA27000049290030000006600000C180005B
// 19640B000200C506 0101 100000 0305108A0D 00 0002AC00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034100 0102 800000 103851 0340108B0D 11DA270042F51B64 00034100 0102 800000 103851 0398108B0D 11DA270000492A0030000006600000C180005C
// 19640B000200C506 0101 100000 0305108A0D 00 0002AC00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034100 0102 800000 103951 0340108B0D 11DA270042F51B64 00034100 0102 800000 103851 0398108B0D 11DA270000492B0030000006600000C180005D
// 19640B000200C506 0101 100000 0305108A0D 00 0002AC00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034100 0102 800000 103851 0340108B0D 11DA270042F51B64 00034100 0102 800000 103851 0398108B0D 11DA270000492C0030000006600000C180005E
// 19640B000200C506 0101 100000 0305108A0D 00 0002AC00 0102 800000 103951 0340108B0D 11DA2700C52000F7 00034100 0102 800000 103851 0340108B0D 11DA270042F51B64 00034100 0102 800000 103851 0398108B0D 11DA270000492D0030000006600000C180005F
// 19640B000200C506 0101 100000 0305108A0D 00 0002AC00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034100 0102 800000 103851 0340108B0D 11DA270042F51B64 00034100 0102 800000 103851 0398108B0D 11DA270000492E0030000006600000C1800060
// 19640B000200C506 0101 100000 0305108A0D 00 0002AC00 0102 800000 103951 0340108B0D 11DA2700C52000F7 00034100 0102 800000 103951 0340108B0D 11DA270042F51B64 00034100 0102 800000 103851 0398108B0D 11DA270000492F0030000006600000C1800061
// 19640B000200C506 0101 100000 0305108A0D 00 0002AC00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034100 0102 800000 103951 0340108B0D 11DA270042F51B64 00034100 0102 800000 103851 0398108B0D 11DA27000049300030000006600000C1800062
// 19640B000200C506 0101 100000 0305108A0D 00 0002AC00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034100 0102 800000 103851 0340108B0D 11DA270042F51B64 00034100 0102 800000 103851 0398108B0D 11DA27000049310030000006600000C1800063
// 19640B000200C506 0101 100000 0305108A0D 00 0002AC00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034100 0102 800000 103851 0340108B0D 11DA270042F51B64 00034100 0102 800000 103851 0398108B0D 11DA27000049320030000006600000C1800064
// 19640B000200C506 0101 100000 0305108A0D 00 0002AC00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034100 0102 800000 103851 0340108B0D 11DA270042F51B64 00034100 0102 800000 103851 0398108B0D 11DA27000049330030000006600000C1800065
// 19640B000200C506 0101 100000 0305108A0D 00 0002AC00 0102 800000 103951 0340108B0D 11DA2700C52000F7 00034100 0102 800000 103851 0340108B0D 11DA270042F51B64 00034100 0102 800000 103851 0398108B0D 11DA27000049340030000006600000C1800066
// 19640B000200C506 0101 100000 0305108A0D 00 0002AC00 0102 800000 103951 0340108B0D 11DA2700C52000F7 00034100 0102 800000 103851 0340108B0D 11DA270042F51B64 00034100 0102 800000 103851 0398108B0D 11DA27000049350030000006600000C1800067
// 19640B000200C506 0101 100000 0305108A0D 00 0002AC00 0102 800000 103951 0340108B0D 11DA2700C52000F7 00034100 0102 800000 103851 0340108B0D 11DA270042F51B64 00034100 0102 800000 103851 0398108B0D 11DA27000049360030000006600000C1800068
// 19640B000200C506 0101 100000 0305108A0D 00 0002AC00 0102 800000 103751 0340108B0D 11DA2700C52000F7 00034100 0102 800000 103851 0340108B0D 11DA270042F51B64 00034100 0102 800000 103851 0398108B0D 11DA27000049370030000006600000C1800069
// 19640B000200C506 0101 100000 0305108A0D 00 0002AC00 0102 800000 103951 0340108B0D 11DA2700C52000F7 00034100 0102 800000 103951 0340108B0D 11DA270042F51B64 00034100 0102 800000 103851 0398108B0D 11DA27000049380030000006600000C180006A
// 19640B000200C506 0101 100000 0305108A0D 00 0002AC00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034100 0102 800000 103751 0340108B0D 11DA270042F51B64 00034100 0102 800000 103851 0398108B0D 11DA27000049390030000006600000C180006B
// //                                                                                                                                                                                                              ott=t*2  t=21 21*2=0x    rr    
// 32=25
// 2f=24
// 2c=22
// 2a=21
// 28=20
// 26=19
// 24=18
// 22=17
// 20=16
// 1e=15
// 1c=14
// 1a=13
// 18=12
// 16=11
// 14=10

// 92
// t*2
// t=21 21*2=0x2a

// 91

// 00
// 20
// 30
// 40
// 60


// |001020304050607 0809 101112 1314151617 18 19202122 2324 252627 282930 3132333435 3637383940414243 44454647 4849 505152 535455 5657585960 6162636465666768 69707172 7374 757677 787980 8182838485 86878889909192939495969798990001020304
//                                                                                                                                                                                                              ott  ff                  rr
// 19640B000200C506 0101 100000 0305108A0D 00 0002AE00 0102 800000 103951 0340108B0D 11DA2700C52000F7 00034400 0102 800000 103851 0340108B0D 11DA2700428E1CFE 00034400 0102 800000 103851 0398108B0D 11DA270000393D0050000006600000C180007F  	11+DA+27+00+00+39+3D+00+50+00+00+06+60+00+00+C1+80+00=37F
// 19640B000200C506 0101 100000 0305108A0D 00 0002AE00 0102 800000 103951 0340108B0D 11DA2700C52000F7 00034400 0102 800000 103851 0340108B0D 11DA2700428E1CFE 00034400 0102 800000 103951 0398108B0D 11DA270000393D0060000006600000C180008F
// 19640B000200C506 0101 100000 0305108A0D 00 0002AE00 0102 800000 103951 0340108B0D 11DA2700C52000F7 00034400 0102 800000 103851 0340108B0D 11DA2700428E1CFE 00034400 0102 800000 103951 0398108B0D 11DA270000393D0070000006600000C180009F
// 19640B000200C506 0101 100000 0305108A0D 00 0002AE00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034400 0102 800000 103951 0340108B0D 11DA2700428E1CFE 00034400 0102 800000 103851 0398108B0D 11DA270000393D00A0000006600000C18000CF
// 19640B000200C506 0101 100000 0305108A0D 00 0002AE00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034400 0102 800000 103851 0340108B0D 11DA2700428E1CFE 00034400 0102 800000 103951 0398108B0D 11DA270000393D00B0000006600000C18000DF
// 19640B000200C506 0101 100000 0305108A0D 00 0002AE00 0102 800000 103951 0340108B0D 11DA2700C52000F7 00034400 0102 800000 103851 0340108B0D 11DA2700428E1CFE 00034400 0102 800000 103851 0398108B0D 11DA270000393D0030000006600000C180005F
// 19640B000200C506 0101 100000 0305108A0D 00 0002AE00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034400 0102 800000 103851 0340108B0D 11DA2700428E1CFE 00034400 0102 800000 103951 0398108B0D 11DA270000393D0040000006600000C180006F
// 19640B000200C506 0101 100000 0305108A0D 00 0002AE00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034400 0102 800000 103851 0340108B0D 11DA2700428E1CFE 00034400 0102 800000 103951 0398108B0D 11DA270000393D0050000006600000C180007F
// 19640B000200C506 0101 100000 0305108A0D 00 0002AE00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034400 0102 800000 103851 0340108B0D 11DA2700428E1CFE 00034400 0102 800000 103951 0398108B0D 11DA270000393D0060000006600000C180008F
// 19640B000200C506 0101 100000 0305108A0D 00 0002AE00 0102 800000 103951 0340108B0D 11DA2700C52000F7 00034400 0102 800000 103851 0340108B0D 11DA2700428E1CFE 00034400 0102 800000 103851 0398108B0D 11DA270000393D0070000006600000C180009F




// |001020304050607 0809 101112 1314151617 18 19202122 2324 252627 282930 3132333435 3637383940414243 44454647 4849 505152 535455 5657585960 6162636465666768 69707172 7374 757677 787980 8182838485 86878889909192939495969798990001020304
//                                                                                                                                                                                                              ott  fs                  rr
// 19640B000200C506 0101 100000 0305108A0D 00 0002AF00 0102 800000 103951 0340108B0D 11DA2700C52000F7 00034500 0102 800000 103851 0340108B0D 11DA270042931C03 00034500 0102 800000 103951 0398108B0D 11DA270000393D0070000006600000C180009F		11+DA+27+00+00+39+3D+00+70+00+00+06+60+00+00+C1+80+00=39F
// 19640B000200C506 0101 100000 0305108A0D 00 0002AE00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034500 0102 800000 103851 0340108B0D 11DA270042931C03 00034500 0102 800000 103951 0398108B0D 11DA270000393D007F000006600000C18000AE
// 19640B000200C506 0101 100000 0305108A0D 00 0002AE00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034500 0102 800000 103851 0340108B0D 11DA270042931C03 00034400 0102 800000 103951 0398108B0D 11DA270000393D0070000006600000C180009F
// 19640B000200C506 0101 100000 0305108A0D 00 0002AE00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034500 0102 800000 103951 0340108B0D 11DA270042931C03 00034500 0102 800000 103951 0398108B0D 11DA270000393D007F000006600000C18000AE
// 19640B000200C506 0101 100000 0305108A0D 00 0002AE00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034500 0102 800000 103851 0340108B0D 11DA270042931C03 00034500 0102 800000 103851 0398108B0D 11DA270000393D0070000006600000C180009F
//                                                                                                                                                                                                              ott  fs s                rr
// 19640B000200C506 0101 100000 0305108A0D 00 0002AE00 0102 800000 103951 0340108B0D 11DA2700C52000F7 00034500 0102 800000 103951 0340108B0D 11DA270042931C03 00034500 0102 800000 103851 0398108B0D 11DA270000393D0070000006600000C180009F
// 19640B000200C506 0101 100000 0305108A0D 00 0002AE00 0102 800000 103951 0340108B0D 11DA2700C52000F7 00034500 0102 800000 103851 0340108B0D 11DA270042931C03 00034500 0102 800000 103951 0398108B0D 11DA270000393D00700F0006600000C18000AE
// 19640B000200C506 0101 100000 0305108A0D 00 0002AE00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034500 0102 800000 103851 0340108B0D 11DA270042931C03 00034500 0102 800000 103951 0398108B0D 11DA270000393D0070000006600000C180009F
// 19640B000200C506 0101 100000 0305108A0D 00 0002AE00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034500 0102 800000 103851 0340108B0D 11DA270042931C03 00034500 0102 800000 103851 0398108B0D 11DA270000393D00700F0006600000C18000AE
// 19640B000200C506 0101 100000 0305108A0D 00 0002AE00 0102 800000 103851 0340108B0D 11DA2700C52000F7 00034400 0102 800000 103851 0340108B0D 11DA270042931C03 00034400 0102 800000 103851 0398108B0D 11DA270000393D0070000006600000C180009F
// 19640B000200C506 0101 100000 0305108A0D 00 0002AF00 0102 800000 103951 0340108B0D 11DA2700C52000F7 00034500 0102 800000 103851 0340108B0D 11DA270042941C04 00034500 0102 800000 103951 0398108B0D 11DA270000393D00700F0006600000C18000AE

// 19640B000200C506 0101 100000 0305108B0D 00 0002B700 0102 800000 103951 0340108B0D 11DA2700C52000F7 00035000 0102 800000 103A51 0340108B0D 11DA270042E31C53 00035000 0102 800000 103951 0398108B0D 11DA2700004928005F0F0006600000C1800098}; 